"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[4049],{50670:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=t(85893),i=t(11151);const a={sidebar_label:"Quickstart",sidebar_position:1},r="Quickstart: Smart Account Native Transfer",s={id:"build/integrations/account-abstraction/biconomy/biconomy-sdk",title:"Quickstart: Smart Account Native Transfer",description:"In this guide, we will walk through creating a basic Node.js script using TypeScript with an implementation of the Smart Account Package from the Biconomy SDK. You will learn how to create a smart account and perform user operations by sending a native transfer of tokens.",source:"@site/docs/build/integrations/account-abstraction/biconomy/biconomy-sdk.md",sourceDirName:"build/integrations/account-abstraction/biconomy",slug:"/build/integrations/account-abstraction/biconomy/biconomy-sdk",permalink:"/ja/docs/build/integrations/account-abstraction/biconomy/biconomy-sdk",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/build/integrations/account-abstraction/biconomy/biconomy-sdk.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_label:"Quickstart",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/ja/docs/build/integrations/account-abstraction/biconomy/"},next:{title:"Astar.js",permalink:"/ja/docs/build/integrations/api/astar.js"}},c={},l=[{value:"Environment set up",id:"environment-set-up",level:2},{value:"Initialization",id:"initialization",level:2},{value:"<strong>Initial Configuration</strong>",id:"initial-configuration",level:3},{value:"Execute your first userOp",id:"execute-your-first-userop",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"quickstart-smart-account-native-transfer",children:"Quickstart: Smart Account Native Transfer"}),"\n",(0,o.jsxs)(n.p,{children:["In this guide, we will walk through creating a basic Node.js script using ",(0,o.jsx)(n.strong,{children:"TypeScript"})," with an implementation of the ",(0,o.jsx)(n.strong,{children:"Smart Account Package"})," from the Biconomy SDK. You will learn how to create a smart account and perform user operations by sending a native transfer of tokens."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Please note that this tutorial assumes you have Node JS installed on your computer and have some working knowledge of Node."})}),"\n",(0,o.jsx)(n.h2,{id:"environment-set-up",children:"Environment set up"}),"\n",(0,o.jsx)(n.p,{children:"We will clone a preconfigured Node.js project with TypeScript support to get started. Follow these steps to clone the repository to your local machine using your preferred command line interface:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Open your command line interface, Terminal, Command Prompt, or PowerShell."}),"\n",(0,o.jsx)(n.li,{children:"Navigate to the desired directory where you would like to clone the repository."}),"\n",(0,o.jsxs)(n.li,{children:["Execute the following command to clone the repository from the provided ",(0,o.jsx)(n.a,{href:"https://github.com/bcnmy/quickstart",children:"GitHub link"})]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone git@github.com:bcnmy/quickstart.git\n"})}),"\n",(0,o.jsx)(n.p,{children:"Note that this is the ssh example, use http or GithubCli options if you prefer."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/bcnmy/quickstart.git\n"})}),"\n",(0,o.jsx)(n.p,{children:"Once you have the repository on your local machine - start by installing all dependencies using your preferred package manager. In this tutorial we will use yarn."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"yarn install\nyarn dev\n"})}),"\n",(0,o.jsxs)(n.p,{children:["After running these two commands you should see the printed statement \u201cHello World!\u201d in your terminal. Any changes made to the ",(0,o.jsx)(n.code,{children:"index.ts"})," file in the src directory should now automatically run in your terminal upon save."]}),"\n",(0,o.jsxs)(n.p,{children:["All packages you need for this guide are all configured and installed for you, check out the ",(0,o.jsx)(n.code,{children:"package.json"})," file if you want to explore the dependencies."]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:" Click to learn more about the packages "}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The account package will help you with creating smart contract accounts and an interface with them to create transactions."}),"\n",(0,o.jsx)(n.li,{children:"The bundler package helps you with interacting with our bundler or alternatively another bundler of your choice."}),"\n",(0,o.jsx)(n.li,{children:"The paymaster package works similarly to the bundler package in that you can use our paymaster or any other one of your choice."}),"\n",(0,o.jsx)(n.li,{children:"The core types package will give us Enums for the proper ChainId we may want to use."}),"\n",(0,o.jsx)(n.li,{children:"The modules package gives us access to the different modules we publish for the biconomy sdk."}),"\n",(0,o.jsx)(n.li,{children:"The common package is needed by our accounts package as another dependency."}),"\n",(0,o.jsx)(n.li,{children:"Finally the ethers package at version 5.7.2 will help us with giving our accounts an owner which will be our own EOA."}),"\n"]})]}),"\n",(0,o.jsx)(n.p,{children:"Let\u2019s first set up a .env file in the root of our project, this will need a Private Key of any Externally Owned Account (EOA) you would like to serve as the owner of the smart account we create. This is a private key you can get from wallets like MetaMask, TrustWallet, Coinbase Wallet etc. All of these wallets will have tutorials on how to export the Private key."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'PRIVATE_KEY = "enter some private key"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Let\u2019s give our script the ability to access this environment variable. Delete the console log inside of ",(0,o.jsx)(n.code,{children:"src/index.ts"})," and replace it with the code below. All of our work for the remainder of the tutorial will be in this file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { config } from "dotenv"\n\nconfig()\n'})}),"\n",(0,o.jsx)(n.p,{children:"Now our code is configured to access the environment variable as needed."}),"\n",(0,o.jsx)(n.h2,{id:"initialization",children:"Initialization"}),"\n",(0,o.jsx)(n.p,{children:"Let\u2019s import our bundler package, and providers from the ethers package:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { IBundler, Bundler } from '@biconomy/bundler'\nimport { DEFAULT_ENTRYPOINT_ADDRESS } from \"@biconomy/account\"\nimport { ethers } from 'ethers'\nimport { ChainId } from \"@biconomy/core-types\"\n"})}),"\n",(0,o.jsx)(n.p,{children:"IBundler is the typing for the Bundler class that we will create a new instance of."}),"\n",(0,o.jsx)(n.h3,{id:"initial-configuration",children:(0,o.jsx)(n.strong,{children:"Initial Configuration"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const bundler: IBundler = new Bundler({\n    bundlerUrl: 'https://bundler.biconomy.io/api/v2/80001/nJPK7B3ru.dd7f7861-190d-41bd-af80-6877f74b8f44',     \n    chainId: ChainId.POLYGON_MUMBAI,\n    entryPointAddress: DEFAULT_ENTRYPOINT_ADDRESS,\n  })\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Now we create an instance of our bundler with the following:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"a bundler url which you can retrieve from the Biconomy Dashboard"}),"\n",(0,o.jsx)(n.li,{children:"chain ID, in this case we\u2019re using Polygon Mumbai testnet"}),"\n",(0,o.jsx)(n.li,{children:"and default entry point address imported from the account package"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import {  BiconomySmartAccountV2, DEFAULT_ENTRYPOINT_ADDRESS } from "@biconomy/account"\n'})}),"\n",(0,o.jsx)(n.p,{children:"Update your import from the account package to also include BiconomySmartAccountV2 which is the class we will be using to create an instance of our smart account."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'const provider = new ethers.providers.JsonRpcProvider("https://rpc.ankr.com/polygon_mumbai")\nconst wallet = new ethers.Wallet(process.env.PRIVATE_KEY || "", provider);\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"We create a provider using a public RPC provider endpoint from Astar Foundation, feel free to use any service you wish."}),"\n",(0,o.jsx)(n.li,{children:"Next we create an instance of the wallet associated to our Private key."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"One more thing we need to include before we move on is the module for our Smart account. You can learn more about modules here. In this instance we will create this smart account using the ECDSA module."}),"\n",(0,o.jsx)(n.p,{children:"First we import our Module:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { ECDSAOwnershipValidationModule, DEFAULT_ECDSA_OWNERSHIP_MODULE } from "@biconomy/modules";\n'})}),"\n",(0,o.jsx)(n.p,{children:"Now let's initialize the module and pass it to our account creation config:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'async function createAccount() {\n\n  const module = await ECDSAOwnershipValidationModule.create({\n    signer: wallet,\n    moduleAddress: DEFAULT_ECDSA_OWNERSHIP_MODULE\n  })\n\n  let biconomySmartAccount = await BiconomySmartAccountV2.create({\n  signer: wallet,\n  chainId: ChainId.POLYGON_MUMBAI,\n  bundler: bundler, \n  entryPointAddress: DEFAULT_ENTRYPOINT_ADDRESS,\n  defaultValidationModule: module,\n  activeValidationModule: module\n})\n  console.log("address: ", await biconomySmartAccount.getAccountAddress())\n  return biconomySmartAccount;\n}\n\n'})}),"\n",(0,o.jsx)(n.p,{children:"We create a new instance of the account using the BiconomySmartAccount class and passing it the configuration."}),"\n",(0,o.jsx)(n.p,{children:"We then await the initialization of the account and log out two values to out terminal: the owner of the account and the smart account address. The owner should be the EOA that you got your private key from and the smart account address will be a new address referring to the address of this wallet."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Smart accounts are counterfactual in nature. We know their address before they are even deployed. In this instance we won\u2019t immediately deploy it, it will automatically be deployed on the first transaction it initiates and the gas needed for deployment will be added to that first transaction."})}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["Before continuing, now that we have our smart account address we need to fund it. Since we are using the Polygon Mumbai network head over to the Polygon Faucet and paste in your smart account address and get some test tokens! If you skip this step you might run into the ",(0,o.jsx)(n.a,{href:"https://docs.biconomy.io/troubleshooting/commonerrors",children:"AA21 didn't pay prefund error"}),"!"]})}),"\n",(0,o.jsx)(n.p,{children:"Once you have tokens available it is time to start constructing our first userOps for a native transfer."}),"\n",(0,o.jsx)(n.h2,{id:"execute-your-first-userop",children:"Execute your first userOp"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"async function createTransaction() {\n  console.log(\"creating account\")\n\n  const smartAccount = await createAccount();\n\n  const transaction = {\n    to: '0x322Af0da66D00be980C7aa006377FCaaEee3BDFD',\n    data: '0x',\n    value: ethers.utils.parseEther('0.1'),\n  }\n\n  const userOp = await smartAccount.buildUserOp([transaction])\n  userOp.paymasterAndData = \"0x\"\n\n  const userOpResponse = await smartAccount.sendUserOp(userOp)\n\n  const transactionDetail = await userOpResponse.wait()\n\n  console.log(\"transaction detail below\")\n  console.log(transactionDetail)\n}\n\ncreateTransaction()\n"})}),"\n",(0,o.jsx)(n.p,{children:"Let\u2019s move the call to create account into the create transaction function and have it assigned to the value smartAccount."}),"\n",(0,o.jsx)(n.p,{children:"Now we need to construct our transaction which will take the following values:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"to"}),": the address this interaction is directed towards, (in this case here is an address I own, feel free to change this to your own or send me more test tokens)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"data"}),": we are defaulting to \u20180x\u2019 as we do not need to send any specific data for this transaction to work since it is a native transfer"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"value"}),": we indicate the amount we would like to transfer here and use the ",(0,o.jsx)(n.code,{children:"parseEther"})," utility function to make sure our value is formatted the way we need it to be"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Next up is building the userOp, feel free to add an additional log here if you would like to see how the partial userOp looks in this case. We\u2019re also going to add \u201c0x\u201d for the paymasterAndData value as we just want this to be a regular transaction where the gas is paid for by the end user."}),"\n",(0,o.jsxs)(n.p,{children:["Finally we send the userOp and save the value to a variable named userOpResponse and get the transactionDetail after calling ",(0,o.jsx)(n.code,{children:"userOpResponse.wait()"}),". This function can optionally take a number to specify the amount of network confirmations you would like before returning a value. For example, if you passed ",(0,o.jsx)(n.code,{children:"userOpResponse.wait(5)"})," this would wait for 5 confirmations on the network before giving you the necessary value."]}),"\n",(0,o.jsx)(n.p,{children:"Check out the long transaction details available now in your console! You just created and executed your first userOps using the Biconomy SDK!"}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:" Click to view final code "}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { config } from "dotenv"\nimport { IBundler, Bundler } from \'@biconomy/bundler\'\nimport { ChainId } from "@biconomy/core-types"\nimport { BiconomySmartAccountV2, DEFAULT_ENTRYPOINT_ADDRESS } from "@biconomy/account"\nimport { ECDSAOwnershipValidationModule, DEFAULT_ECDSA_OWNERSHIP_MODULE } from "@biconomy/modules";\nimport { ethers } from \'ethers\';\n\nconfig()\n\nconst provider = new ethers.providers.JsonRpcProvider("https://rpc.ankr.com/polygon_mumbai")\nconst wallet = new ethers.Wallet(process.env.PRIVATE_KEY || "", provider);\n\nconst bundler: IBundler = new Bundler({\n  bundlerUrl: \'https://bundler.biconomy.io/api/v2/80001/nJPK7B3ru.dd7f7861-190d-41bd-af80-6877f74b8f44\',     \n  chainId: ChainId.POLYGON_MUMBAI,\n  entryPointAddress: DEFAULT_ENTRYPOINT_ADDRESS,\n})\n\nconst module = await ECDSAOwnershipValidationModule.create({\n  signer: wallet,\n  moduleAddress: DEFAULT_ECDSA_OWNERSHIP_MODULE\n})\n\n  async function createAccount() {\n    let biconomyAccount = await BiconomySmartAccountV2.create({\n      signer: wallet,\n      chainId: ChainId.POLYGON_MUMBAI,\n      bundler: bundler, \n      entryPointAddress: DEFAULT_ENTRYPOINT_ADDRESS,\n      defaultValidationModule: module,\n      activeValidationModule: module\n    })\n    console.log("address", biconomyAccount.accountAddress)\n    return biconomyAccount\n  }\n\n  async function createTransaction() {\n    const smartAccount = await createAccount();\n    try {\n      const transaction = {\n        to: \'0x322Af0da66D00be980C7aa006377FCaaEee3BDFD\',\n        data: \'0x\',\n        value: ethers.utils.parseEther(\'0.1\'),\n      }\n    \n      const userOp = await smartAccount.buildUserOp([transaction])\n      userOp.paymasterAndData = "0x"\n    \n      const userOpResponse = await smartAccount.sendUserOp(userOp)\n    \n      const transactionDetail = await userOpResponse.wait()\n    \n      console.log("transaction detail below")\n      console.log(`https://mumbai.polygonscan.com/tx/${transactionDetail.receipt.transactionHash}`)\n    } catch (error) {\n      console.log(error)\n    }\n  }\n\n  createTransaction()\n'})})]}),"\n",(0,o.jsx)(n.p,{children:"Now that you have completed our quickstart take a look at exploring further usecases in our Quick Explore guide or our Node JS guides!"})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>r});var o=t(67294);const i={},a=o.createContext(i);function r(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);