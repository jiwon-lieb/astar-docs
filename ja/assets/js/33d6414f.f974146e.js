"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[3014],{60965:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var t=s(85893),a=s(11151);const o={sidebar_position:6},r="Node Maintenance",i={id:"build/nodes/node-maintenance",title:"Node Maintenance",description:"Backup",source:"@site/docs/build/nodes/node-maintenance.md",sourceDirName:"build/nodes",slug:"/build/nodes/node-maintenance",permalink:"/ja/docs/build/nodes/node-maintenance",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/build/nodes/node-maintenance.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Node Commands",permalink:"/ja/docs/build/nodes/node-commands"},next:{title:"Run an EVM Tracing Node",permalink:"/ja/docs/build/nodes/evm-tracing-node"}},c={},d=[{value:"Backup",id:"backup",level:2},{value:"In case of an incident on the main collator",id:"in-case-of-an-incident-on-the-main-collator",level:3},{value:"Get node logs",id:"get-node-logs",level:2},{value:"Upgrade node",id:"upgrade-node",level:2},{value:"Purge node",id:"purge-node",level:2},{value:"Snapshot",id:"snapshot",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"node-maintenance",children:"Node Maintenance"}),"\n",(0,t.jsx)(n.h2,{id:"backup",children:"Backup"}),"\n",(0,t.jsx)(n.p,{children:"Maintaining a backup node that is in sync with a collator is vital to ensuring continuous and uninterrupted block production, and avoiding the possibility of being slashed. We highly recommend locating a backup node in a different physical location, with a different provider."}),"\n",(0,t.jsxs)(n.p,{children:["Note: The collator session keys are stored in ",(0,t.jsx)(n.code,{children:"/var/lib/astar/chains/{NETWORK}/keystore"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["You may need to install the rsync package depending on your distro (using ",(0,t.jsx)(n.code,{children:"sudo apt-get install rsync"})," or similar)"]})}),"\n",(0,t.jsxs)(n.admonition,{type:"caution",children:[(0,t.jsx)(n.p,{children:"Ensure you create a backup of the keystore folder on your local machine using the following command:"}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:'rsync --rsync-path="sudo rsync" -r {MAIN_SERVER_IP}:/var/lib/astar/chains/{NETWORK}/keystore .'})})]}),"\n",(0,t.jsx)(n.h3,{id:"in-case-of-an-incident-on-the-main-collator",children:"In case of an incident on the main collator"}),"\n",(0,t.jsxs)(n.p,{children:["On the ",(0,t.jsx)(n.strong,{children:"backup collator server"}),", stop the collator service and remove keys:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl stop {NETWORK}.service\nsudo rm -rf /var/lib/astar/chains/{NETWORK}/keystore/*\n"})}),"\n",(0,t.jsxs)(n.p,{children:["On your ",(0,t.jsx)(n.strong,{children:"local machine"}),", from your ",(0,t.jsx)(n.strong,{children:"backup directory"}),", copy the keys into the keystore folder of the backup server:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'rsync --rsync-path="sudo rsync" -r ./keystore {BACKUP_SERVER_IP}:/var/lib/astar/chains/{NETWORK}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["On the ",(0,t.jsx)(n.strong,{children:"backup collator server"}),", update permission of the ",(0,t.jsx)(n.code,{children:"astar"})," directory and restart the collator service:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo chown -R astar:astar /var/lib/astar/\nsudo systemctl start {NETWORK}.service\n"})}),"\n",(0,t.jsx)(n.h2,{id:"get-node-logs",children:"Get node logs"}),"\n",(0,t.jsx)(n.p,{children:"To get the last 100 lines from the node logs, use the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"journalctl -fu astar-collator -n100\n"})}),"\n",(0,t.jsx)(n.h2,{id:"upgrade-node",children:"Upgrade node"}),"\n",(0,t.jsxs)(n.p,{children:["When a node upgrade is necessary, node operators are notified with instructions in the ",(0,t.jsx)(n.a,{href:"https://t.me/+cL4tGZiFAsJhMGJk",children:"Astar Dev Announcement Telegram"})," and ",(0,t.jsx)(n.a,{href:"https://discord.gg/astarnetwork",children:"Astar Discord"}),". Join and follow these channels to receive news about node updates and node upgrades."]}),"\n",(0,t.jsxs)(n.p,{children:["Download the ",(0,t.jsx)(n.a,{href:"https://github.com/AstarNetwork/Astar/releases/latest",children:"latest release"})," from Github:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'wget $(curl -s https://api.github.com/repos/AstarNetwork/Astar/releases/latest | grep "tag_name" | awk \'{print "https://github.com/AstarNetwork/Astar/releases/download/" substr($2, 2, length($2)-3) "/astar-collator-v" substr($2, 3, length($2)-4) "-ubuntu-x86_64.tar.gz"}\')\ntar -xvf astar-collator*.tar.gz\n'})}),"\n",(0,t.jsx)(n.p,{children:"Move the new release binary and restart the service:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo mv ./astar-collator /usr/local/bin\nsudo chmod +x /usr/local/bin/astar-collator\nsudo systemctl restart {NETWORK}.service\n"})}),"\n",(0,t.jsx)(n.h2,{id:"purge-node",children:"Purge node"}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Never purge the chain data on an active collator"})," or it will not produce blocks during the sync process, and therefore reduce the block production rate of the chain.\nInstead, switch to your backup node and ",(0,t.jsx)(n.em,{children:"only"})," purge the chain data after it is ",(0,t.jsx)(n.strong,{children:"actively collating"}),"."]})}),"\n",(0,t.jsx)(n.p,{children:"To start a node from scratch without any existing chain data, simply wipe the chain data directory:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl stop {NETWORK}.service\nsudo rm -R /var/lib/astar/chains/{NETWORK}/db/*\nsudo systemctl start {NETWORK}.service\n"})}),"\n",(0,t.jsx)(n.h2,{id:"snapshot",children:"Snapshot"}),"\n",(0,t.jsxs)(n.p,{children:["Please refer to ",(0,t.jsx)(n.strong,{children:"snapshot page"}),"(/docs/build/nodes/snapshots)."]})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>i,a:()=>r});var t=s(67294);const a={},o=t.createContext(a);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);