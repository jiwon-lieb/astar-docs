"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[3131],{10637:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>o});var a=n(85893),t=n(11151);const i={sidebar_position:8},r="The Astar Gas Station",l={id:"build/environment/gas-station",title:"The Astar Gas Station",description:"Integrate with the Astar Networks Gas Station for optimal priority fee.",source:"@site/docs/build/environment/gas-station.md",sourceDirName:"build/environment",slug:"/build/environment/gas-station",permalink:"/ja/docs/build/environment/gas-station",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/build/environment/gas-station.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Chopsticks & E2E Tests",permalink:"/ja/docs/build/environment/chopsticks"},next:{title:"Swanky Dev Container",permalink:"/ja/docs/build/environment/dev-container"}},c={},o=[{value:"Documentation of the calculations",id:"documentation-of-the-calculations",level:2},{value:"<code>GasPriceOracle</code>",id:"gaspriceoracle",level:3},{value:"Estimates",id:"estimates",level:3},{value:"GasPriceOracle",id:"gaspriceoracle-1",level:3},{value:"Substrate Tip Calculation",id:"substrate-tip-calculation",level:2},{value:"Using the gas station",id:"using-the-gas-station",level:2},{value:"Example output",id:"example-output",level:3},{value:"Related Documents",id:"related-documents",level:2}];function h(e){const s={a:"a",admonition:"admonition",annotation:"annotation",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",math:"math",mermaid:"mermaid",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",mtext:"mtext",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h1,{id:"the-astar-gas-station",children:"The Astar Gas Station"}),"\n",(0,a.jsx)(s.admonition,{type:"note",children:(0,a.jsx)(s.p,{children:"Integrate with the Astar Networks Gas Station for optimal priority fee."})}),"\n",(0,a.jsx)(s.h2,{id:"documentation-of-the-calculations",children:"Documentation of the calculations"}),"\n",(0,a.jsx)(s.mermaid,{value:"graph TD\n GasPriceOracle --\x3e|RPC + calcs| h\n  estimate --\x3e|20 blocks + percentiles| h\n  h{harverster} --\x3e|every 1 minutes| firestore\n  firestore <--\x3e https"}),"\n",(0,a.jsx)(s.h3,{id:"gaspriceoracle",children:(0,a.jsx)(s.code,{children:"GasPriceOracle"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Each EVM RPC is queried using the ",(0,a.jsx)(s.a,{href:"https://github.com/peppersec/gas-price-oracle",children:"GasPriceOracle"})," module"]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"    const oracle = new GasPriceOracle({\n      defaultRpc: 'https://evm.shibuya.astar.network',\n      blocksCount: 200,\n      chainId: 81,\n    });\n    \n    /*\n    {\n      estimate: {\n        baseFee: 779.371350051,\n        maxFeePerGas: 782.371350051,\n        maxPriorityFeePerGas: 3\n      },\n      gasPrices: {\n        instant: 1013.182755066,\n        fast: 935.245620061,\n        standard: 857.308485056,\n        low: 779.371350051\n      }\n    }\n    */\n"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["The GasPriceOracle Github repo does not mention how it does it\u2019s calculations but from the results I could infer and confirm these results:","\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Low Gas Price"}),": is the base fee."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Standard Gas Price"}),": 110% of the base fee."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Fast Gas Price"}),": 120% of the base fee."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Instant Gas Price"}),": 130% of the base fee."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"estimates",children:"Estimates"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["8 months ago (October 30, 2022), a change was implemented to gather the ",(0,a.jsx)(s.code,{children:"gasPrices"})," from the last 20 blocks and use percentiles of the results."]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"for (let i = latest.number; i > latest.number - 20; i--) {\n      block = await web3[network].eth.getBlock(i);\n      for (let j = 0; j < block.transactions.length; j++) {\n        txn = await web3[network].eth.getTransaction(block.transactions[j]);\n        gasPrices.push(Number(txn.gasPrice));\n      }\n    }\n\nconst percentiles = percentile([35, 60, 90, 99], gasPrices);\n"})}),"\n",(0,a.jsx)(s.h3,{id:"gaspriceoracle-1",children:"GasPriceOracle"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["As of November 1st, 2023, the ",(0,a.jsx)(s.code,{children:"GasPriceOracle"}),", is bein used as fall back values if an error occurred and the percentiles were undefined."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"substrate-tip-calculation",children:"Substrate Tip Calculation"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["The substrate tip is exactly the EVM price calculations multiplied:",(0,a.jsx)(s.br,{}),"\n",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"T"}),(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"p"}),(0,a.jsx)(s.mtext,{children:"\xa0"}),(0,a.jsx)(s.mi,{children:"V"}),(0,a.jsx)(s.mi,{children:"a"}),(0,a.jsx)(s.mi,{children:"l"}),(0,a.jsx)(s.mi,{children:"u"}),(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mi,{children:"G"}),(0,a.jsx)(s.mi,{children:"a"}),(0,a.jsx)(s.mi,{children:"s"}),(0,a.jsx)(s.mtext,{children:"\xa0"}),(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"r"}),(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"c"}),(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mo,{children:"\xd7"}),(0,a.jsx)(s.mn,{children:"1000"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"Tip\xa0Value=Gas\xa0Price\xd71000"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"T"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,a.jsx)(s.span,{className:"mord",children:"\xa0"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"Va"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"u"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.7667em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"G"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,a.jsx)(s.span,{className:"mord",children:"\xa0"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"ce"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"\xd7"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(s.span,{className:"mord",children:"1000"})]})]})]})]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"using-the-gas-station",children:"Using the gas station"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Shibuya API: GET\xa0",(0,a.jsx)(s.a,{href:"https://gas.astar.network/api/gasnow?network=shibuya&type=tip",children:"https://gas.astar.network/api/gasnow?network=shibuya&type=tip"})]}),"\n",(0,a.jsxs)(s.li,{children:["Shiden API: GET\xa0",(0,a.jsx)(s.a,{href:"https://gas.astar.network/api/gasnow?network=shiden&type=tip",children:"https://gas.astar.network/api/gasnow?network=shiden&type=tip"})]}),"\n",(0,a.jsxs)(s.li,{children:["Astar API: GET\xa0",(0,a.jsx)(s.a,{href:"https://gas.astar.network/api/gasnow?network=astar&type=tip",children:"https://gas.astar.network/api/gasnow?network=astar&type=tip"})]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"example-output",children:"Example output"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'{\n   "code":200,\n   "data":{\n      "average":"857308485056",\n      "fast":"935245620061",\n      "slow":"779371350051",\n      "fastest":"1013182755066",\n      "eip1559":{\n         "priorityFeePerGas":{\n            "average":"857308485056",\n            "fast":"935245620061",\n            "slow":"779371350051",\n            "fastest":"1013182755066"\n         },\n         "maxPriorityFeePerGas":"3000000000",\n         "baseFeePerGas":"779000000000",\n         "maxFeePerGas":"782000000000"\n      },\n      "tip":{\n         "average":"857308485056000",\n         "fast":"935245620061000",\n         "slow":"779371350051000",\n         "fastest":"1013182755066000"\n      },\n      "timestamp":1699544357434\n   }\n}\n'})}),"\n",(0,a.jsx)(s.h2,{id:"related-documents",children:"Related Documents"}),"\n",(0,a.jsx)(s.p,{children:"Include any links to relevant external documents."}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Repo: ",(0,a.jsx)(s.a,{href:"https://github.com/AstarNetwork/gas-station",children:"https://github.com/AstarNetwork/gas-station"})]}),"\n",(0,a.jsxs)(s.li,{children:["website: ",(0,a.jsx)(s.a,{href:"https://gas.astar.network/",children:"https://gas.astar.network/"})]}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},11151:(e,s,n)=>{n.d(s,{Z:()=>l,a:()=>r});var a=n(67294);const t={},i=a.createContext(t);function r(e){const s=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);