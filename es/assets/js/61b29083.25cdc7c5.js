"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[3569],{75458:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var t=s(85893),o=s(11151);const i={sidebar_position:7},a="Chopsticks & E2E Tests",r={id:"build/environment/chopsticks",title:"Chopsticks & E2E Tests",description:"Create parallel realities of our Substrate networks.",source:"@site/docs/build/environment/chopsticks.md",sourceDirName:"build/environment",slug:"/build/environment/chopsticks",permalink:"/es/docs/build/environment/chopsticks",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/build/environment/chopsticks.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Zombienet",permalink:"/es/docs/build/environment/zombienet-testing"},next:{title:"The Astar Gas Station",permalink:"/es/docs/build/environment/gas-station"}},c={},l=[{value:"Chopsticks",id:"chopsticks",level:2},{value:"Dev mode",id:"dev-mode",level:3},{value:"XCM mode",id:"xcm-mode",level:3},{value:"Specific block",id:"specific-block",level:4},{value:"Creating blocks",id:"creating-blocks",level:4},{value:"Config Settings",id:"config-settings",level:2},{value:"E2E Tests",id:"e2e-tests",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"chopsticks--e2e-tests",children:"Chopsticks & E2E Tests"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Create parallel realities of our Substrate networks."})}),"\n",(0,t.jsx)(n.p,{children:"Forking a live blockchain at any block with the corresponding memory and state offers several benefits for developers, users, and the blockchain ecosystem as a whole. This capability allows for more accurate testing of transactions and upgrades, which can lead to better decision-making and more robust blockchain networks. Key benefits include:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Improved security: By forking a live blockchain, developers can test proposed changes, identify vulnerabilities, and address potential security threats in a controlled environment, reducing the risk of attacks on the main network."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Enhanced performance: Testing transactions and upgrades on a forked version of the blockchain enables developers to analyze the performance implications of their changes, such as transaction throughput and latency."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Reduced downtime: Forking a live blockchain for testing purposes can help minimize network downtime during upgrades or other maintenance activities, as it allows developers to thoroughly test and validate changes before implementation on the main network."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Increased user confidence: Users can feel more confident in the stability and reliability of the blockchain network when they know that proposed changes have been rigorously tested in an environment that closely mirrors the live network."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Facilitated innovation: Forking a live blockchain provides a space for experimentation, allowing developers to test new features, protocols, and consensus algorithms without disrupting the main network."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Streamlined consensus-building: Forking a live blockchain enables developers to present real-world test results to stakeholders, which can help build consensus for proposed changes."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Simplified debugging: Debugging transactions and smart contracts on a forked version of the blockchain allows developers to isolate and address issues more easily, ensuring that only well-vetted code is introduced to the main network."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"chopsticks",children:"Chopsticks"}),"\n",(0,t.jsx)(n.p,{children:"Setting up a parallel reality for our networks is easy with chopsticks."}),"\n",(0,t.jsxs)(n.p,{children:["This documentation focuses on the use of chopsticks with the Astar networks.\nFor more details on the options and settings, refer to the ",(0,t.jsx)(n.a,{href:"https://github.com/AcalaNetwork/chopsticks",children:"Chopsticks repository readme file"})]}),"\n",(0,t.jsx)(n.h3,{id:"dev-mode",children:"Dev mode"}),"\n",(0,t.jsx)(n.p,{children:"You can run forked version of the network at any block using this command."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npx @acala-network/chopsticks@latest -c astar\n"})}),"\n",(0,t.jsx)(n.p,{children:"or"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npx @acala-network/chopsticks@latest -c shiden\n"})}),"\n",(0,t.jsxs)(n.p,{children:["and simply examine the local setup by using PJS on it.\n",(0,t.jsx)(n.a,{href:"https://polkadot.js.org/apps/?rpc=ws://localhost:8000#/explorer",children:"https://polkadot.js.org/apps/?rpc=ws://localhost:8000#/explorer"})]}),"\n",(0,t.jsx)(n.h3,{id:"xcm-mode",children:"XCM mode"}),"\n",(0,t.jsx)(n.p,{children:"You can also run continous modes for XCM development with HRMP channesl"}),"\n",(0,t.jsx)(n.p,{children:"Just Astar connected to Shiden:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npx @acala-network/chopsticks@latest xcm -p astar -p shiden\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or with a relaychain like so:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npx @acala-network/chopsticks@latest xcm -r polkadot -p astar -p statemint\n"})}),"\n",(0,t.jsx)(n.h4,{id:"specific-block",children:"Specific block"}),"\n",(0,t.jsx)(n.p,{children:"You can specify a block number on the cli using the -c and not the XCM cli format."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npx @acala-network/chopsticks@latest -c astar -b 3500000\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To use a specific block number in the XCM mode, you'll need to download the ",(0,t.jsx)(n.code,{children:".yml"})," file and modify the block number within."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"endpoint: wss://astar.api.onfinality.io/public-ws\nmock-signature-host: true\nblock: 3600000\n...\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then just start you XCM as usual."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npx @acala-network/chopsticks@latest xcm -p astar.yml\n"})}),"\n",(0,t.jsx)(n.h4,{id:"creating-blocks",children:"Creating blocks"}),"\n",(0,t.jsxs)(n.p,{children:["To create new blocks, you'll need to connect to the websocket port of that node.  To do so, you can use ",(0,t.jsx)(n.code,{children:"wscat"}),", just install it if your system does not have it.  For example ",(0,t.jsx)(n.code,{children:"sudo apt-get install wscat"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'wscat -c ws://127.0.0.1:8000 -x \'{ "jsonrpc": "2.0", "id": 1, "method": "dev_newBlock", "params": [{"count": 100}] }\'\n'})}),"\n",(0,t.jsx)(n.p,{children:"You can also do it with the WsProvider:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const { WsProvider } = require("@polkadot/api");\n\nasync function main() {\n  const provider = new WsProvider("ws://localhost:8000");\n  await provider.isReady;\n  await provider.send("dev_newBlock", [{ count: 10 }]);\n  console.log("10 new blocks created");\n}\n\nmain()\n  .catch(console.error)\n  .finally(() => process.exit());\n'})}),"\n",(0,t.jsx)(n.h2,{id:"config-settings",children:"Config Settings"}),"\n",(0,t.jsxs)(n.p,{children:["In the short form of the parachain/relaychain cli parameter, the configs are getting pulled from the github repo on demand. For example, here is ",(0,t.jsx)(n.a,{href:"https://github.com/AcalaNetwork/chopsticks/blob/master/configs/astar.yml",children:"Astar's"})," config. You can always download it locally and modify it's content to suit your needs. Note that the configs already has Alice with:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"100k of ASTR, DOT & USDT on Polkadot and 100k of SDN, KSM & USDT on Kusama"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"e2e-tests",children:"E2E Tests"}),"\n",(0,t.jsx)(n.p,{children:"End-to-end (E2E) tests offers numerous benefits, such as it enables developers to accurately assess the security, performance, and scalability of proposed changes in a controlled environment that closely mirrors the live network. This approach fosters innovation, simplifies debugging, and streamlines consensus-building among stakeholders. Ultimately, it contributes to more stable, reliable, and efficient blockchain networks, increasing user confidence and promoting long-term success."}),"\n",(0,t.jsx)(n.p,{children:"These tests uses chopstick to do end to end testing and validate results with previous tests."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"git clone git@github.com:AcalaNetwork/e2e-tests.git\ncd e2e-tests\nyarn\nyarn test ./tests/xcm-transfer/kusama-relay.test.ts\n"})}),"\n",(0,t.jsx)(n.p,{children:"or for more verbose logging when developping tests, use the playground:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"yarn vitest --inspect playground --single-thread\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>a});var t=s(67294);const o={},i=t.createContext(o);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);