"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[5951],{18787:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var s=n(85893),r=n(11151);const a={sidebar_position:1,description:"Using Gelato Relay, we relay your user's transactions on-chain, enabling secure gasless transactions for an ultra-smooth UX for your app"},o="Gelato Relay",i={id:"build/zkEVM/integrations/account-abstraction/relayers/gelato-relay",title:"Gelato Relay",description:"Using Gelato Relay, we relay your user's transactions on-chain, enabling secure gasless transactions for an ultra-smooth UX for your app",source:"@site/docs/build/zkEVM/integrations/account-abstraction/relayers/gelato-relay.md",sourceDirName:"build/zkEVM/integrations/account-abstraction/relayers",slug:"/build/zkEVM/integrations/account-abstraction/relayers/gelato-relay",permalink:"/docs/build/zkEVM/integrations/account-abstraction/relayers/gelato-relay",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/build/zkEVM/integrations/account-abstraction/relayers/gelato-relay.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,description:"Using Gelato Relay, we relay your user's transactions on-chain, enabling secure gasless transactions for an ultra-smooth UX for your app"},sidebar:"tutorialSidebar",previous:{title:"Relayers",permalink:"/docs/build/zkEVM/integrations/account-abstraction/relayers/"},next:{title:"Particle Network Smart Wallet-as-a-Service",permalink:"/docs/build/zkEVM/integrations/account-abstraction/particle-network"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Getting started",id:"getting-started",level:2},{value:"1: Installation",id:"1-installation",level:3},{value:"2: Choose the Method",id:"2-choose-the-method",level:3},{value:"3: Implementation",id:"3-implementation",level:3},{value:"4: Tracking your request",id:"4-tracking-your-request",level:3},{value:"5: Templates",id:"5-templates",level:3},{value:"Rate Limits, Fees &amp; Contract Addresses",id:"rate-limits-fees--contract-addresses",level:2},{value:"Rates",id:"rates",level:3},{value:"Gelato&#39;s Fees",id:"gelatos-fees",level:3},{value:"Contract Addresses",id:"contract-addresses",level:3},{value:"Learn more",id:"learn-more",level:2}];function d(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"gelato-relay",children:"Gelato Relay"}),"\n",(0,s.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(t.p,{children:"Using Gelato Relay, we relay your user's transactions on-chain, enabling secure gasless transactions for an ultra-smooth UX for your app. This allows for a variety of new web3 experiences, as the user can now pay by only signing a message, or their transaction costs can be sponsored by the developer. As long as the gas costs are covered in one of the multiple payment methods that Gelato supports, we handle the rest reliably, quickly and securely."}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:'"node": ">=14.0.0"'}),"\n",(0,s.jsx)(t.li,{children:"Basic JavaScript knowledge."}),"\n",(0,s.jsx)(t.li,{children:"ethers knowledge"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,s.jsx)(t.h3,{id:"1-installation",children:"1: Installation"}),"\n",(0,s.jsx)(t.p,{children:"Install the Gelato Relay SDK"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"yarn add @gelatonetwork/relay-sdk\n"})}),"\n",(0,s.jsx)(t.h3,{id:"2-choose-the-method",children:"2: Choose the Method"}),"\n",(0,s.jsx)(t.p,{children:"At this point, you will need to answer the following questions, which will determine the method to use when calling the Gelato Relay."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Do you require user authentication?"}),"\nWhen the use-case requires to authenticate the original user, you will need to implement the ERC2771 method where the user will sign the payload, and the original user will be decoded on-chain from the callData replacing ",(0,s.jsx)(t.code,{children:"msg.sender"})," through ",(0,s.jsx)(t.code,{children:"_msgSender()"}),", please see additional info ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/erc-2771-recommended",children:"here"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"What is the funding strategy?"}),"\nWhen relaying a transaction, the Gelato Nodes are paying the gas fees. There are two different ways of paying the fees back to Gelato. Either creating a ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/1balance",children:"1Balance"})," account and deposit USDC on polygon that will pay for all of the transactions on all EVM chains Gelato is deployed; or transferring back to gelato the fees while the transaction is executing, we call these methods ",(0,s.jsx)(t.code,{children:"syncFee"}),", more info can be found ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/payment-and-fees#syncfee",children:"here"}),", in this latter case, the target contract would need to inherit the ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/non-erc-2771/callwithsyncfee/relay-context-contracts",children:'"Gelato Relay Context"'})," contracts, so the methods to query and transfer the fee to Gelato are available."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If you require user authentication and you want to pay the transactions with a 1Balance account, the method to use is the ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/erc-2771-recommended/sponsoredcallerc2771l",children:"sponsoredCallERC2771"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If you require user authentication and you want every transaction to pay for itself, transferring by execution the fees to Gelato, the method to use is the ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/erc-2771-recommended/callwithsyncfeeerc2771",children:"callWithSyncFeeERC2771"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If you don't require user authentication and you want to pay the transactions with a 1Balance account, the method to use is the ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/non-erc-2771/sponsoredcall",children:"sponsoredCall"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If you don't require user authentication and you want every transaction to pay for itself, transferring the fees by execution to Gelato, the method to use is the ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/non-erc-2771/callwithsyncfee",children:"callWithSyncFee"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"3-implementation",children:"3: Implementation"}),"\n",(0,s.jsxs)(t.p,{children:["We will require three simple steps to implement Gelato Relay.\nHere, we are going to showcase the three steps required to implement the method ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/erc-2771-recommended/sponsoredcallerc2771l",children:"sponsoredCallERC2771"}),", which is the most used one."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Step 1: Inherit Context Contract",(0,s.jsx)(t.br,{}),"\n","Depending on the method, you must inherit different contracts as they will provide other methods. In this case, we will have to inherit the ",(0,s.jsx)(t.a,{href:"https://github.com/gelatodigital/relay-context-contracts/blob/master/contracts/vendor/ERC2771Context.sol",children:"ERC2771Context"}),". The ERC2771Context provide us with the methods ",(0,s.jsx)(t.code,{children:"_msgSender()"})," and ",(0,s.jsx)(t.code,{children:"_msgData()"})," that will allow us to recover the original user sending the transaction."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sol",children:'    import {\n        ERC2771Context\n    } from "@gelatonetwork/relay-context/contracts/vendor/ERC2771Context.sol";\n\n    contract CounterERC2771 is ERC2771Context {\n\n        // ERC2771Context: setting the immutable trustedForwarder variable\n        constructor(address trustedForwarder) ERC2771Context(trustedForwarder) {}\n\n        function incrementContext() external {\n\n            // Incrementing the counter mapped to the _msgSender!\n            contextCounter[_msgSender()]++;\n            \n            // Emitting an event for testing purposes\n            emit IncrementContextCounter(_msgSender());\n        }\n    }\n'})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Step 2: Import the relay SDK",(0,s.jsx)(t.br,{}),"\n","In your frontend/backend, you would need to import and instantiate the relay class."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:'    import { GelatoRelay, SponsoredCallERC2771Request } from "@gelatonetwork/relay-sdk";\n    const relay = new GelatoRelay(API_KEY);\n'})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Step 3: Send the payload to Gelato",(0,s.jsx)(t.br,{}),"\n","This is an example using Gelato's CounterERC2771.sol, which is deployed on these networks."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:'    // Set up on-chain variables, such as target address\n    const counter = "0x00172f67db60E5fA346e599cdE675f0ca213b47b"; \n    const abi = ["function incrementContext()"];\n    const provider = new ethers.BrowserProvider(window.ethereum);\n    const signer = provider.getSigner();\n    const user = signer.getAddress();\n\n    // Generate the target payload\n    const contract = new ethers.Contract(counter, abi, signer);\n    const { data } = await contract.incrementContext.populateTransaction();\n\n    // Populate a relay request\n    const request: CallWithERC2771Request = {\n      chainId: (await provider.getNetwork()).chainId,\n      target: counter;\n      data: data;\n      user: user;\n    };\n\n    // Without a specific API key, the relay request will fail! \n    // Go to https://relay.gelato.network to get a testnet API key with 1Balance.\n    // Send a relay request using Gelato Relay!\n    const relayResponse = await relay.sponsoredCallERC2771(request, provider, apiKey);\n'})}),"\n",(0,s.jsx)(t.h3,{id:"4-tracking-your-request",children:"4: Tracking your request"}),"\n",(0,s.jsx)(t.p,{children:"When submitting your Gelato Relay requests, you'll receive a taskId in response. This taskId allows you to track the status of your request in two primary ways:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["WebSocket Subscriptions: This is the recommended and most efficient method. By subscribing via WebSocket, the Gelato backend will automatically push updates for all your tasks to your Relay SDK client. To start receiving these updates, you must register a callback function, which will be triggered every time one of your tasks gets updated. Detailed implementation can be found ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/tracking-your-relay-request#websocket-subscriptions",children:"here"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Polling for Updates: Alternatively, you can periodically query the Gelato task status API for updates. If you're using the Gelato Relay SDK, the getTaskStatus method makes this easy. Detailed implementation can be found ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/tracking-your-relay-request#polling-for-updates",children:"here"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"5-templates",children:"5: Templates"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://github.com/gelatodigital/relay-examples-frontend-backend-v5",children:"Example repo"})," showcasing all Relay SDK methods with node and react implementations"]}),"\n",(0,s.jsxs)(t.li,{children:["Relay Hardhat ",(0,s.jsx)(t.a,{href:"https://github.com/gelatodigital/relay-example-unit-tests",children:"unit tests"})]}),"\n",(0,s.jsxs)(t.li,{children:["Relay ",(0,s.jsx)(t.a,{href:"https://github.com/gelatodigital/relay-sponsored-nft-mint",children:"sponsored nft mint"})]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"rate-limits-fees--contract-addresses",children:"Rate Limits, Fees & Contract Addresses"}),"\n",(0,s.jsx)(t.h3,{id:"rates",children:"Rates"}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["Pro Tier: For access to pro tier and custom rate limits, please request an upgrade ",(0,s.jsx)(t.a,{href:"https://www.gelato.network/contact",children:"here"})]})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Standard Rate Limits"}),(0,s.jsx)(t.th,{children:"Pro Rate limits"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"5 req/min"}),(0,s.jsx)(t.td,{children:"30 req/min"})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"gelatos-fees",children:"Gelato's Fees"}),"\n",(0,s.jsx)(t.p,{children:"Gelato charges a fixed 10% percentage fee of the relayed transactions' total gas cost."}),"\n",(0,s.jsx)(t.h3,{id:"contract-addresses",children:"Contract Addresses"}),"\n",(0,s.jsxs)(t.p,{children:["Please visit ",(0,s.jsx)(t.a,{href:"https://docs.gelato.network/developer-services/relay/networks-and-rate-limits#contract-addresses",children:"Gelato Contract Addresses"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"learn-more",children:"Learn more"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://www.gelato.network/",children:"Gelato Website"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://docs.gelato.network/introduction/what-is-gelato",children:"Gelato Docs"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>o});var s=n(67294);const r={},a=s.createContext(r);function o(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);