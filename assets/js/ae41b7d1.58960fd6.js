"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[9519],{62621:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var r=t(85893),c=t(11151);const i={sidebar_position:3},o="ManicMinter Contract",a={id:"tutorials/from-zero-to-ink-hero/manic-minter/manic-contract",title:"ManicMinter Contract",description:"This tutorial will not include complete code from the contract to keep it short and focused on the cross contract calls and e2e tests. The full code for this example is available here",source:"@site/docs/tutorials/from-zero-to-ink-hero/manic-minter/manic-contract.md",sourceDirName:"tutorials/from-zero-to-ink-hero/manic-minter",slug:"/tutorials/from-zero-to-ink-hero/manic-minter/manic-contract",permalink:"/docs/tutorials/from-zero-to-ink-hero/manic-minter/manic-contract",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/tutorials/from-zero-to-ink-hero/manic-minter/manic-contract.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"ManicMinter Setup",permalink:"/docs/tutorials/from-zero-to-ink-hero/manic-minter/manic-setup"},next:{title:"ManicMinter e2e Test",permalink:"/docs/tutorials/from-zero-to-ink-hero/manic-minter/manic-e2e"}},s={},l=[{value:"Storage",id:"storage",level:2},{value:"Error and Types",id:"error-and-types",level:2},{value:"Contract Trait",id:"contract-trait",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Cross Contract Call",id:"cross-contract-call",level:2},{value:"Cargo Update",id:"cargo-update",level:2},{value:"Oxygen Contract Update",id:"oxygen-contract-update",level:2},{value:"Summary of the ManicMinter Contract Chapter",id:"summary-of-the-manicminter-contract-chapter",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"manicminter-contract",children:"ManicMinter Contract"}),"\n",(0,r.jsxs)(n.p,{children:["This tutorial will not include complete code from the contract to keep it short and focused on the cross contract calls and e2e tests. The full code for this example is available ",(0,r.jsx)(n.a,{href:"https://github.com/swanky-dapps/manic-minter",children:"here"})]}),"\n",(0,r.jsx)(n.h2,{id:"storage",children:"Storage"}),"\n",(0,r.jsxs)(n.p,{children:["To start with delete the boilerplate code from the ",(0,r.jsx)(n.code,{children:"lib.rs"})," file.\nThe storage will be defined as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"pub struct ManicMinter {\n    /// Contract owner\n    owner: AccountId,\n    /// Oxygen contract address\n    token_contract: AccountId,\n    /// Minting price. Caller must pay this price to mint one new token from Oxygen contract\n    price: Balance,\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"error-and-types",children:"Error and Types"}),"\n",(0,r.jsx)(n.p,{children:"We will define the error and types as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"/// The ManicMinter error types.\npub enum Error {\n    /// Returned if not enough balance to fulfill a request is available.\n    BadMintValue,\n    /// Returned if the token contract account is not set during the contract creation.\n    ContractNotSet,\n    /// The call is not allowed if the caller is not the owner of the contract\n    NotOwner,\n    /// Returned if multiplication of price and amount overflows\n    OverFlow,\n    /// Returned if the cross contract transaction failed\n    TransactionFailed,\n}\n\npub type Result<T> = core::result::Result<T, Error>;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"contract-trait",children:"Contract Trait"}),"\n",(0,r.jsx)(n.p,{children:"The following trait will be used to define the contract interface:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"pub trait Minting {\n    /// Mint new tokens from Oxygen contract\n    #[ink(message, payable)]\n    fn manic_mint(&mut self, amount: Balance) -> Result<()>;\n\n    /// Set minting price for one Oxygen token\n    #[ink(message)]\n    fn set_price(&mut self, price: Balance) -> Result<()>;\n\n    /// Get minting price for one Oxygen token\n    #[ink(message)]\n    fn get_price(&self) -> Balance;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,r.jsx)(n.p,{children:"The constructor will be defined as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"impl ManicMinter {\n    #[ink(constructor)]\n    pub fn new(contract_acc: AccountId) -> Self {\n        Self {\n            owner: Self::env().caller(),\n            token_contract: contract_acc,\n            price: 0,\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cross-contract-call",children:"Cross Contract Call"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"manic_mint"})," method will execute cross contract call to Oxygen contract using ",(0,r.jsx)(n.code,{children:"Call Builder"}),". The method will be defined as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'impl Minting for ManicMinter {\n    #[ink(message, payable)]\n    fn manic_mint(&mut self, amount: Balance) -> Result<()> {\n        //---- snip ----\n\n        let mint_result = build_call::<DefaultEnvironment>()\n            .call(self.token_contract)\n            .gas_limit(5000000000)\n            .exec_input(\n                ExecutionInput::new(Selector::new(ink::selector_bytes!("PSP22Mintable::mint")))\n                    .push_arg(caller)\n                    .push_arg(amount),\n            )\n            .returns::<()>()\n            .try_invoke();\n\n        //---- snip ----\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Let's go over the code line by line:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"build_call().call()"}),"  method is called passing Oxygen contract address as an argument."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"gas_limit"})," method is invoked with a value of 5000000000 to set the gas limit for the contract execution."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"exec_input"})," method is used to specify the execution input for the contract call."]}),"\n",(0,r.jsxs)(n.li,{children:["An ",(0,r.jsx)(n.code,{children:"ExecutionInput"})," instance is created with the selector ",(0,r.jsx)(n.code,{children:"PSP22Mintable::mint"})," with the arguments of ",(0,r.jsx)(n.code,{children:"caller"})," address and ",(0,r.jsx)(n.code,{children:"amount"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"returns"})," method is called to specify the expected return type of the contract call, which in this case is ()."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"try_invoke"})," method is called to execute the contract call and capture any potential errors."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["To learn more about the ",(0,r.jsx)(n.code,{children:"Call Builder"})," and other methods for cross contract call please refer to the ",(0,r.jsx)(n.a,{href:"https://use.ink/basics/cross-contract-calling",children:"ink! documentation"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"cargo-update",children:"Cargo Update"}),"\n",(0,r.jsxs)(n.p,{children:["Update ",(0,r.jsx)(n.code,{children:"Cargo.toml"})," dependency with the following content:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[dependencies]\nink = { version = "4.1.0", default-features = false }\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Since we will use PSP22 by Openbrush in our e2e test we need to add it under ",(0,r.jsx)(n.code,{children:"dev-dependencies"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[dev-dependencies]\nink_e2e = "4.1.0"\nopenbrush = { tag = "3.1.0", git = "https://github.com/727-Ventures/openbrush-contracts", default-features = false, features = ["psp34", "ownable"] }\noxygen = { path = "../oxygen", default-features = false, features = ["ink-as-dependency"] }\n'})}),"\n",(0,r.jsx)(n.h2,{id:"oxygen-contract-update",children:"Oxygen Contract Update"}),"\n",(0,r.jsx)(n.p,{children:"Since we are using Oxygen contract for our testing we need to update it to be able to use it as a dependency. The code is already provided in the previous chapter, but please note that"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Cargo.toml"}),"  needs to be updated to become a library:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'crate-type = [\n    "rlib",\n]\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["At the top of the ",(0,r.jsx)(n.code,{children:"lib.rs"})," file for Oxygen contract add ",(0,r.jsx)(n.code,{children:"ref"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"pub use self::oxygen::OxygenRef;\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Under the ",(0,r.jsx)(n.code,{children:"features"})," section of the ",(0,r.jsx)(n.code,{children:"Cargo.toml"})," file add the following:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:"ink-as-dependency = [] \n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This is a prerequisite for ManicMinter contract to import the Oxygen library in the ",(0,r.jsx)(n.code,{children:"Cargo.toml"})," file with feature ",(0,r.jsx)(n.code,{children:"ink-as-dependency"}),":"]}),"\n"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'oxygen = { path = "../oxygen", default-features = false, features = ["ink-as-dependency"] }\n'})})]}),"\n",(0,r.jsx)(n.h2,{id:"summary-of-the-manicminter-contract-chapter",children:"Summary of the ManicMinter Contract Chapter"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The ManicMinter contract mints new fungible tokens."}),"\n",(0,r.jsx)(n.li,{children:"The ManicMinter contract mints Oxygen tokens by invoking cross contract call to Oxygen contract."}),"\n",(0,r.jsxs)(n.li,{children:["The Oxygen contract needs to be set as library with ",(0,r.jsx)(n.code,{children:"ink-as-dependency"})," feature to be used as a dependency in the ManicMinter contract."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The full code for this example is available ",(0,r.jsx)(n.a,{href:"https://github.com/swanky-dapps/manic-minter",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>o});var r=t(67294);const c={},i=r.createContext(c);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);