"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[2719],{61142:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>l,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var n=s(85893),a=s(11151);const r={sidebar_position:1},c="Smart Contract Stack",i={id:"build/wasm/smart-contract-wasm",title:"Smart Contract Stack",description:"Smart Contract Runtime Environment",source:"@site/docs/build/wasm/smart-contract-wasm.md",sourceDirName:"build/wasm",slug:"/build/wasm/smart-contract-wasm",permalink:"/docs/build/wasm/smart-contract-wasm",draft:!1,unlisted:!1,editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/build/wasm/smart-contract-wasm.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Wasm Smart Contracts",permalink:"/docs/build/wasm/"},next:{title:"DSLs",permalink:"/docs/build/wasm/dsls"}},o={},d=[{value:"Smart Contract Runtime Environment",id:"smart-contract-runtime-environment",level:2},{value:"Execution Engine",id:"execution-engine",level:3},{value:"Two-step Deployment of Contracts",id:"two-step-deployment-of-contracts",level:3},{value:"For More Information About <code>pallet-contracts</code>",id:"for-more-information-about-pallet-contracts",level:3},{value:"Client APIs",id:"client-apis",level:2},{value:"The Wasm Stack vs. Ethereum",id:"the-wasm-stack-vs-ethereum",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"smart-contract-stack",children:"Smart Contract Stack"}),"\n",(0,n.jsx)(t.h2,{id:"smart-contract-runtime-environment",children:"Smart Contract Runtime Environment"}),"\n",(0,n.jsxs)(t.p,{children:["Astar & Shiden runtimes are based on Substrate, and both networks incorporate ",(0,n.jsx)(t.code,{children:"pallet-contracts"}),", a sandboxed environment used to deploy and execute WebAssembly smart contracts. Any language that compiles to Wasm may be deployed and run on this Wasm Virtual Machine, however, the code should be compatible with the ",(0,n.jsx)(t.code,{children:"pallet-contracts"})," ",(0,n.jsx)(t.a,{href:"https://docs.rs/pallet-contracts/latest/pallet_contracts/api_doc/trait.Current.html",children:"API"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["To avoid unnecessary complexity, and writing boilerplate code, the most appropriate method of building will involve the use of an eDSL specifically targeting ",(0,n.jsx)(t.code,{children:"pallet-contracts"}),", such as ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/ink",children:"ink!"})," (based on Rust), or ",(0,n.jsx)(t.a,{href:"https://github.com/ask-lang/ask",children:"ask!"})," (based on AssemblyScript), or possibly others as the ecosystem grows."]}),"\n",(0,n.jsx)(t.p,{children:"After compilation, a Wasm blob can then be deployed and stored on-chain."}),"\n",(0,n.jsx)(t.h3,{id:"execution-engine",children:"Execution Engine"}),"\n",(0,n.jsxs)(t.p,{children:["Pallet-contracts uses ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/wasmi",children:"wasmi"})," as a Wasm interpreter to execute Wasm smart contract blobs. Although there is a faster JIT interpreter such as ",(0,n.jsx)(t.a,{href:"https://github.com/bytecodealliance/wasmtime",children:"wasmtime"})," available in the native runtime, smart contracts are an untrusted environment which require a higher degree of correctness of interpretation, which makes wasmi a more suitable option."]}),"\n",(0,n.jsx)(t.h3,{id:"two-step-deployment-of-contracts",children:"Two-step Deployment of Contracts"}),"\n",(0,n.jsx)(t.p,{children:"The contract code (Wasm blob), and contract address and storage are decoupled from one another other, so require two steps to deploy a new contract on-chain:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["First, upload the Wasm contract on-chain (every contract Wasm code has a ",(0,n.jsx)(t.code,{children:"code_hash"})," as an identifier)."]}),"\n",(0,n.jsx)(t.li,{children:"Second, instantiate the contract - it will create an address and storage for that contract."}),"\n",(0,n.jsxs)(t.li,{children:["Anyone can instantiate a contract based on its ",(0,n.jsx)(t.code,{children:"code_hash"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"There are several benefits of decoupling the contract code from the address/storage:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["To save space on-chain. Since a contract can have several constructors and instantiations, a redeployment will create a new instance based on the same underlying code. Think about standardized tokens, like ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/PSPs/blob/master/PSPs/psp-22.md",children:"PSP22"})," & ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/PSPs/blob/master/PSPs/psp-34.md",children:"PSP34"}),", that will have one ",(0,n.jsx)(t.code,{children:"code_hash"})," & ",(0,n.jsx)(t.code,{children:"blob"})," living on-chain, and as many instantiations as are needed, rather than having to upload code with each new instantiation (for example, on Ethereum)."]}),"\n",(0,n.jsxs)(t.li,{children:["To instantiate a new contract using code within an existing smart contract (see the delegator example), ",(0,n.jsx)(t.code,{children:"code_hash"})," is all that is needed."]}),"\n",(0,n.jsxs)(t.li,{children:["Some standard contracts such as (",(0,n.jsx)(t.a,{href:"https://github.com/w3f/PSPs/blob/master/PSPs/psp-22.md",children:"PSP22"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/PSPs/blob/master/PSPs/psp-34.md",children:"PSP34"}),") will only be uploaded on-chain once, preventing users from having to pay gas costs for uploading new code."]}),"\n",(0,n.jsxs)(t.li,{children:["Update contract code for an address: replace the contract code at the specified address with new code (see ",(0,n.jsx)(t.a,{href:"https://docs.rs/ink_env/4.0.0-rc/ink_env/fn.set_code_hash.html",children:"set_code_hash"}),"). Storage and balances will be preserved."]}),"\n"]}),"\n",(0,n.jsxs)(t.h3,{id:"for-more-information-about-pallet-contracts",children:["For More Information About ",(0,n.jsx)(t.code,{children:"pallet-contracts"})]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.a,{href:"https://docs.rs/pallet-contracts/14.0.0/pallet_contracts/index.html",children:[(0,n.jsx)(t.code,{children:"pallet-contracts"})," in Rust docs"]})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.a,{href:"https://github.com/paritytech/substrate/tree/master/frame/contracts",children:[(0,n.jsx)(t.code,{children:"pallet-contracts"})," on Github"]})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"client-apis",children:"Client APIs"}),"\n",(0,n.jsxs)(t.p,{children:["The only library available to communicate with smart contracts is ",(0,n.jsx)(t.a,{href:"https://github.com/polkadot-js/api",children:"Polkadot.js API"}),"."]}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"This API provides application developers the ability to query a node and interact with the Polkadot or Substrate chains using Javascript."})}),"\n",(0,n.jsxs)(t.p,{children:["Parity also developed a web application to interact with contracts called ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/contracts-ui",children:"contracts-ui"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"the-wasm-stack-vs-ethereum",children:"The Wasm Stack vs. Ethereum"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{}),(0,n.jsx)(t.th,{children:"Ethereum"}),(0,n.jsx)(t.th,{children:"Astar"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"L1 Architecture"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://ethereum.org/en/developers/docs/nodes-and-clients/",children:"Ethereum clients"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://substrate.io/",children:"Substrate"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Smart Contract Runtime Environment"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://ethereum.org/en/developers/docs/evm/",children:"EVM"})}),(0,n.jsxs)(t.td,{children:["Wasm ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/substrate/tree/master/frame/contracts",children:"pallet-contract"})," + EVM ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/frontier",children:"frontier"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Gas Model"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://ethereum.github.io/yellowpaper/paper.pdf",children:"fixed price per instruction"})}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/how-to-guides/weights/",children:"weight"})," + ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/substrate/blob/c00ed052e7cd72cfc4bc0e00e38722081b789ff5/frame/contracts/src/lib.rs#L351",children:"storage fees"})," + ",(0,n.jsx)(t.a,{href:"https://github.com/paritytech/substrate/blob/97ae6be11b0132224a05634c508417f048894670/frame/contracts/src/lib.rs#L331-L350",children:"loading fees"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Smart Contract DSLs"}),(0,n.jsx)(t.td,{children:"Solidity and Vyper"}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.a,{href:"https://github.com/paritytech/ink",children:"ink!"})," (Rust) and ",(0,n.jsx)(t.a,{href:"https://github.com/ask-lang/ask",children:"ask!"})," (AssemblyScript)"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Standards"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://eips.ethereum.org/",children:"EIPs"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://github.com/w3f/PSPs",children:"PSPs"})})]})]})]})]})}function l(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},11151:(e,t,s)=>{s.d(t,{Z:()=>i,a:()=>c});var n=s(67294);const a={},r=n.createContext(a);function c(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);